<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>√î Ch·ªØ Qu√¢n ƒê·ªôi NDVN ‚Äî B·∫£n s·ª≠a</title>
  <link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {font-family: 'Play', sans-serif; background:radial-gradient(ellipse at top, #0f2248 0%, #0a142a 60%, #0a1429 100%); color:#e1eafc; padding:12px; overflow-x:hidden; line-height:1.5;}
    .app{width:100%; max-width:1200px; margin:64px auto 0;}

    /* MENU */
    #dp_menu{position:fixed; top:16px; right:16px; z-index:1000}
    #dp_menu *{box-sizing:border-box}
    #dp_menu > button{width:40px; height:40px; display:inline-grid; place-items:center; border:none; cursor:pointer; border-radius:12px; background:linear-gradient(180deg,#0e315a,#0a2a4a); color:#eaf2ff; box-shadow:0 8px 22px rgba(0,0,0,.35); border:1px solid #1e406e; padding:0; outline:none;}
    #dp_menu > button:before{content:"\2261"; font-weight:700; font-size:18px; line-height:1;}
    #dp_menu.show > button:before{content:"\00D7"}
    #dp_menu ul, #dp_menu li{margin:0; padding:0; list-style:none}
    #dp_menu ul{position:absolute; top:48px; right:0; width:180px; background:#fff; color:#0c2544; border:1px solid #dfe7f3; border-radius:12px; box-shadow:0 16px 34px rgba(3,16,36,.25); overflow:hidden; opacity:0; transform:translateY(6px) scale(.98); pointer-events:none; transition:opacity .18s ease, transform .18s ease;}
    #dp_menu.show ul{opacity:1; transform:none; pointer-events:auto}
    #dp_menu li a{display:flex; align-items:center; gap:10px; padding:10px 12px; color:inherit; text-decoration:none; font-weight:700; font-size:14px}
    #dp_menu li + li a{border-top:1px solid #eef3fb}
    #dp_menu li a .ico{width:18px; display:inline-grid; place-items:center; opacity:.9}
    #dp_menu li a:hover{background:#f3f7ff}

    /* Tr√≤ ch∆°i */
    :root{--bg:#0a1429; --panel:#0d1a33; --muted:#8fa3c7; --text:#e1eafc; --line:#1d2c4a; --accent:#22d3ee; --accent2:#a78bfa; --army-green:#2d5016; --army-dark:#1a2f0d; --army-light:#4a7c1f; --tile1:#7a2a00; --tile2:#bf4b0a; --tileBorder:#ffc98b; --tile:clamp(32px, 7vw, 44px); --gap:clamp(3px, 0.8vw, 5px);}
    *{box-sizing:border-box; margin:0; padding:0}
    .header {display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:20px;flex-wrap:wrap;text-align:center}
    .logo {width: 90px;height: 90px;border-radius: 50%;background: radial-gradient(circle at 30% 30%, #2d5016, #1a2f0d);border: 3px solid #ffc98b;display: flex;align-items: center;justify-content: center;box-shadow: 0 4px 12px rgba(0,0,0,0.35);overflow: hidden}
    .logo-img {width: 85%;height: 85%;object-fit: contain;border-radius: 50%;background-color: #fff;padding: 4px;box-shadow: inset 0 0 4px rgba(0,0,0,0.3);transition: transform 0.3s ease}
    .logo:hover .logo-img {transform: scale(1.05)}
    .title {font-size: clamp(20px, 3vw, 28px);color:#fff;text-shadow: 0 2px 4px rgba(0,0,0,0.5);margin-bottom: 4px;text-align:center}
    .subtitle {font-size: clamp(13px, 1.8vw, 16px);color: #cfe0ff;text-align:center}

    .main-container {display:flex;flex-direction:column;gap:16px}
    .keyword-section {display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:10px}
    .keyword-title {font-size: clamp(16px, 2vw, 20px);color: #ffc98b;margin:0;text-align:center}
    .keyword-row {display:flex;gap: var(--gap);justify-content:center;flex-wrap:wrap}
    .keyword-cell {width: var(--tile);height: var(--tile);border-radius: 8px;border: 2px solid var(--tileBorder);display: grid;place-items: center;background: linear-gradient(135deg, var(--army-dark), var(--army-green));font-weight: 900;font-size: clamp(16px, 3.5vw, 20px);color: #ffc98b;text-shadow: 0 1px 2px #000;box-shadow: 0 4px 8px rgba(0,0,0,0.3)}
    .keyword-cell.ready {box-shadow: 0 0 0 3px var(--accent) inset, 0 4px 8px rgba(0,0,0,0.3)}

    .crossword-grid {display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width: 900px) {.crossword-grid {grid-template-columns: 1fr 280px;}}

    .questions-panel {background: linear-gradient(160deg, #0d1830, #0a1426);border: 1px solid #2a3a5a;border-radius: 12px;padding: 12px;box-shadow: 0 8px 24px rgba(0,0,0,0.4);position: relative;overflow: hidden;width: 100%}
    .questions-panel::before {content: '';position: absolute;top: 0;left: 0;right: 0;height: 4px;background: linear-gradient(90deg, var(--army-green), var(--army-light))}
    .questions-title {margin: 0 0 12px;font-size: 18px;color: #ffc98b;text-align: center;width: 100%;font-weight: 600;line-height: 1.2;padding: 0 8px}
    .questions-list {display:grid;gap:12px;width:100%}

    .question-item {display:flex;flex-direction:column;gap:8px;padding:12px;border:1px dashed #2a3a5a;border-radius:10px;transition: all .3s ease;cursor:pointer;background: rgba(255,255,255,0.03);width:100%;box-sizing:border-box;max-width:100%;overflow:hidden}
    @media (min-width: 768px){.question-item{display:grid;grid-template-columns:120px 1fr;align-items:start;gap:12px}}
    .question-item:hover {border-color:#3a4a7a;background: rgba(255,255,255,0.07)}
    .question-item.solved {border-style: solid;border-color:#2a5c2a;background: rgba(42,92,42,0.15)}

    .question-number {display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:0;width:100%;box-sizing:border-box}
    @media (min-width:768px){.question-number{justify-content:flex-start;margin-bottom:0;width:auto;min-width:120px}}
    .question-btn {padding:10px 14px;border:1px solid #3a4a6a;border-radius:8px;background: linear-gradient(135deg, #1a2f0d, #2d5016);color:#ffc98b;cursor:pointer;font-size:13px;font-family: Arial, sans-serif;white-space:nowrap;font-weight:600;box-shadow:0 2px 4px rgba(0,0,0,0.2);transition:all .2s;width:100%;max-width:120px;text-align:center;display:flex;align-items:center;justify-content:center;height:36.8px;box-sizing:border-box}
    @media (max-width:767px){.question-btn{max-width:100px;padding:8px 12px;font-size:12px;height:36px}}
    .question-btn:hover{border-color:#4a5a7a;transform: translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,0.3)}

    .question-content {display:flex;flex-direction:column;gap:8px;width:100%;overflow:hidden;align-items:center;box-sizing:border-box}
    @media (min-width:768px){.question-content{align-items:flex-start;min-width:0}}
    .question-placeholder {color:#8fa3c7;font-style:italic;text-align:center;font-size:clamp(13px,1.6vw,15px);line-height:1.4;padding:4px 0;width:100%;box-sizing:border-box;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    @media (min-width:768px){.question-placeholder{text-align:left;white-space:normal}}

    .answer-cells {display:flex;flex-wrap:nowrap;gap:var(--gap);overflow-x:auto;padding:4px 2px 8px 2px;width:100%;-webkit-overflow-scrolling:touch;justify-content:flex-start;box-sizing:border-box}
    .answer-cells::-webkit-scrollbar{height:6px}
    .answer-cells::-webkit-scrollbar-track{background: rgba(255,255,255,0.1);border-radius:3px}
    .answer-cells::-webkit-scrollbar-thumb{background: var(--army-light);border-radius:3px}
    .answer-cell {width:30px;height:30px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:900;letter-spacing:.06em;font-size:12px;background:linear-gradient(135deg,var(--tile2),var(--tile1));color:#FFFAF0;text-shadow:0 1px 2px #000;border:2px solid var(--tileBorder);box-shadow:0 2px 4px rgba(0,0,0,0.3), inset 0 0 0 1px rgba(255,255,255,0.1);flex-shrink:0;min-width:0}
    @media (min-width:480px){.answer-cell{width:clamp(32px,7vw,40px);height:clamp(32px,7vw,40px);font-size:clamp(12px,2.8vw,16px)}}
    .answer-cell.pivot {box-shadow:0 0 0 3px #40e0ff inset, 0 0 8px #1bdfff}
    .answer-cell.revealed {animation: pop .3s ease}
    @keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}

    .control-panel {background: linear-gradient(160deg, #0d1830, #0a1426);border:1px solid #2a3a5a;border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,0.4);display:flex;flex-direction:column;gap:16px;position:relative;overflow:hidden;width:100%;box-sizing:border-box}
    .control-panel::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background: linear-gradient(90deg, var(--accent), var(--accent2))}
    .control-title{margin:0 0 12px;font-size:clamp(16px,2vw,20px);color:#ffc98b;text-align:center;width:100%}
    .control-section{display:flex;flex-direction:column;gap:10px;width:100%}
    .section-title{font-size:14px;color:#cfe0ff;margin-bottom:6px}
    .input-group{display:flex;flex-direction:column;gap:8px;width:100%}
    input[type="text"]{background:#0a1122;color:#e1eafc;border:1px solid #2a3a5a;border-radius:8px;padding:10px 12px;outline:none;font-size:14px;width:100%;transition:all .2s;box-sizing:border-box}
    input[type="text"]:focus{border-color:var(--accent);box-shadow:0 0 0 2px rgba(34,211,238,.2)}
    .btn-primary{background: linear-gradient(135deg,#0ea5e9,#22d3ee);color:#051018;border:none;border-radius:8px;padding:10px 14px;font-weight:700;cursor:pointer;font-size:clamp(13px,1.6vw,15px);box-shadow:0 4px 8px rgba(0,0,0,0.3);transition:all .2s;width:100%;box-sizing:border-box}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.4)}
    .btn-secondary{background: linear-gradient(135deg,#1a2f0d,#2d5016);color:#ffc98b;border:1px solid #3a4a6a;border-radius:8px;padding:10px 14px;font-weight:700;cursor:pointer;font-size:clamp(13px,1.6vw,15px);box-shadow:0 4px 8px rgba(0,0,0,0.3);transition:all .2s;width:100%;box-sizing:border-box}
    .btn-secondary:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.4)}
    .message{font-size:13px;color:#8fa3c7;text-align:center;line-height:1.4}

    .qa-panel{margin-top:16px;display:none;width:100%}
    .qa-panel.active{display:block;animation: fadeIn .3s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .qa-question{padding:14px 16px;border:1px solid #2a3a5a;border-radius:10px;background: rgba(10,17,34,.7);font-size:clamp(14px,1.6vw,16px);line-height:1.5;margin-bottom:14px;width:100%;box-sizing:border-box}
    .qa-controls{display:flex;flex-direction:column;gap:10px;width:100%}
    .qa-input-group{display:flex;gap:8px;flex-wrap:wrap;width:100%}
    @media (max-width:480px){.qa-input-group{flex-direction:column}.qa-input-group button{width:100%}}
    .qa-feedback{font-size:13px;color:#8fa3c7;min-height:18px;text-align:center}

    .answers-panel{margin-top:20px;display:none;width:100%}
    .answers-panel.active{display:block;animation: fadeIn .5s ease}
    .answers-title{margin:0 0 14px;font-size:clamp(16px,2vw,20px);color:#ffc98b;text-align:center;width:100%}
    .answer-item{margin-bottom:14px;padding:14px;border-radius:8px;background: rgba(255,255,255,.05);border-left:4px solid var(--army-light);width:100%;box-sizing:border-box}
    .answer-question{font-weight:bold;margin-bottom:6px;font-size:clamp(13px,1.6vw,15px);color:#cfe0ff}
    .answer-text{color:var(--accent);font-size:clamp(13px,1.6vw,15px);font-weight:600}

    .footer{margin-top:20px;display:flex;flex-direction:column;gap:12px;color:#8fa3c7;font-size:12px;border-top:1px solid #2a3a5a;padding-top:12px;width:100%}
    .footer-tip{text-align:center;line-height:1.5;width:100%}

    .ladder{display:grid;grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));gap:8px;width:100%}

    .shake{animation: shake .4s ease}
    @keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-5px)}40%,80%{transform:translateX(5px)}}

    @media (max-width:767px){
      .questions-panel{padding:10px}
      .question-item{padding:10px;gap:6px}
      .footer-controls{flex-direction:column;align-items:center}
      .ladder{grid-template-columns: repeat(auto-fill, minmax(60px, 1fr))}
      .control-panel{padding:12px}
      .questions-title{font-size:16px;margin:0 0 12px;padding:0 4px}
      .question-content{padding:0 4px}
      .answer-cells{padding:4px 1px 8px 1px}
    }

    /* Nh·∫•n m·∫°nh h·∫°t n·ªï nh·ªè */
    .burst circle{filter: drop-shadow(0 0 6px #ffffff); mix-blend-mode: screen}
  </style>
</head>
<body>
  <!-- MENU -->
  <nav id="dp_menu" aria-label="Menu ch√≠nh">
    <button id="dp_toggle" type="button" aria-expanded="false" aria-controls="dp_list"></button>
    <ul id="dp_list" class="sub-menu" role="menu" aria-hidden="false">
<li role="menuitem">
  <a href="https://thanhhungk57.github.io/baotuong/"  return false;">
    <span class="ico">üè†</span><span>Trang ch√≠nh</span>
  </a>
</li>

      <li role="menuitem"><a href="#" onclick="restart();dpCloseMenu(); return false;"><span class="ico">üîÅ</span><span>Ch∆°i l·∫°i</span></a></li>
      <li role="menuitem"><a href="#" onclick="showAllAnswers();dpCloseMenu(); document.getElementById('answersPanel').scrollIntoView({behavior:'smooth'}); return false;"><span class="ico">‚úÖ</span><span>Hi·ªÉn th·ªã ƒë√°p √°n</span></a></li>
      <li role="menuitem"><a href="#" onclick="showRules();dpCloseMenu(); return false;"><span class="ico">üìú</span><span>Xem lu·∫≠t ch∆°i</span></a></li>
    </ul>
  </nav>


  
  <div class="app" id="home">
    <div class="header">
      <div class="logo"><img src="logodoan.png" alt="Logo Qu√¢n ƒê·ªôi" class="logo-img"></div>
      <div class="title-section">
        <h1 class="title">√î CH·ªÆ QU√ÇN ƒê·ªòI NH√ÇN D√ÇN VI·ªÜT NAM</h1>
        <div class="subtitle">Truy·ªÅn th·ªëng v·∫ª vang - Chi·∫øn c√¥ng l·ª´ng l·∫´y</div>
      </div>
    </div>

    <div class="main-container">
      <div class="keyword-section">
        <h2 class="keyword-title">T·ª™ KH√ìA D·ªåC</h2>
        <div id="keyword" class="keyword-row"></div>
        <div class="input-group">
          <input id="finalGuess" type="text" placeholder="Nh·∫≠p t·ª´ kh√≥a d·ªçc..." />
          <button id="btnFinal" class="btn-primary">KI·ªÇM TRA T·ª™ KH√ìA</button>
          <div id="finalMsg" class="message">Tr·∫£ l·ªùi ƒë√∫ng m·ªói c√¢u h·ªèi s·∫Ω h√© l·ªô m·ªôt ch·ªØ c√°i trong t·ª´ kh√≥a</div>
        </div>
      </div>

      <div class="crossword-grid">
        <section class="questions-panel">
          <h2 class="questions-title">C√ÇU H·ªéI √î CH·ªÆ</h2>
          <div id="questions" class="questions-list"></div>

          <div id="qa" class="qa-panel">
            <div id="qtext" class="qa-question"></div>
            <div class="qa-controls">
              <div class="qa-input-group">
                <input id="answer" type="text" placeholder="Nh·∫≠p ƒë√°p √°n (c√≥ th·ªÉ kh√¥ng d·∫•u)..." />
                <button id="btnCheck" class="btn-primary">KI·ªÇM TRA</button>
                <button id="btnClose" class="btn-secondary">ƒê√ìNG</button>
              </div>
              <div id="feedback" class="qa-feedback"></div>
            </div>
          </div>

          <div id="answersPanel" class="answers-panel">
            <h2 class="answers-title">ƒê√ÅP √ÅN HO√ÄN CH·ªàNH</h2>
            <div id="answersList"></div>
          </div>
        </section>

        <aside class="control-panel">
          <h2 class="control-title">ƒêI·ªÄU KHI·ªÇN</h2>
          <div class="control-section">
            <div class="section-title">Ch·ªçn c√¢u h·ªèi</div>
            <div id="ladder" class="ladder"></div>
          </div>
          <div class="control-section">
            <div class="section-title">H∆∞·ªõng d·∫´n</div>
            <div class="message">T·ª´ kh√≥a d·ªçc ƒë∆∞·ª£c t·∫°o th√†nh t·ª´ c√°c ch·ªØ c√°i giao nhau c·ªßa ƒë√°p √°n ngang.</div>
            <button id="btnRestart" class="btn-secondary">CH∆†I L·∫†I</button>
          </div>
        </aside>
      </div>

      <div class="footer">
        <div class="footer-tip"><b>M·∫πo ch∆°i:</b> M·ªói ƒë√°p √°n ƒë√∫ng s·∫Ω ti·∫øt l·ªô m·ªôt ch·ªØ c√°i trong t·ª´ kh√≥a d·ªçc. H√£y quan s√°t k·ªπ v·ªã tr√≠ c√°c ch·ªØ c√°i giao nhau.</div>
      </div>
    </div>
  </div>

  <!-- Modal lu·∫≠t ch∆°i -->
  <div id="rulesModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:3000;align-items:center;justify-content:center;">
    <div style="background:linear-gradient(180deg,#0d203f,#08172e);color:#eaf2ff;border:1px solid #2a4f88;border-radius:14px;padding:24px;max-width:480px;width:90%;box-shadow:0 8px 30px rgba(0,0,0,0.6);text-align:left;line-height:1.6;">
      <h2 style="margin-top:0;text-align:center;color:#4ad1ff;">üìú Lu·∫≠t ch∆°i √î Ch·ªØ</h2>
      <ul style="padding-left:20px;margin:0;">
        <li>M·ªói c√¢u h·ªèi t∆∞∆°ng ·ª©ng v·ªõi m·ªôt h√†ng √¥ ch·ªØ ngang.</li>
        <li>Khi tr·∫£ l·ªùi ƒë√∫ng, to√†n b·ªô h√†ng √¥ ch·ªØ s·∫Ω ƒë∆∞·ª£c m·ªü ra.</li>
        <li>M·ªói h√†ng c√≥ m·ªôt √¥ giao c·∫Øt v·ªõi t·ª´ kh√≥a d·ªçc ‚Äî k√Ω t·ª± n√†y s·∫Ω ƒë∆∞·ª£c ti·∫øt l·ªô.</li>
        <li>Khi ƒë√£ bi·∫øt ƒë·ªß c√°c ch·ªØ c√°i, h√£y nh·∫≠p t·ª´ kh√≥a d·ªçc ƒë·ªÉ chi·∫øn th·∫Øng!</li>
        <li>B·∫•m ‚ÄúCh∆°i l·∫°i‚Äù ƒë·ªÉ b·∫Øt ƒë·∫ßu v√°n m·ªõi.</li>
      </ul>
      <div style="text-align:center;margin-top:18px;">
        <button onclick="closeRules();" style="background:linear-gradient(180deg,#2e90ff,#1b6cd6);color:#fff;border:none;border-radius:10px;padding:10px 20px;font-weight:700;cursor:pointer;">ƒê√£ hi·ªÉu</button>
      </div>
    </div>
  </div>

  <!-- Info Box -->
  <div id="infoBox" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:3000; align-items:center; justify-content:center;">
    <div style="background:linear-gradient(180deg,#0d203f,#08172e); border:1px solid #2a4f88; border-radius:14px; padding:24px; max-width:600px; width:90%; box-shadow:0 8px 30px rgba(0,0,0,0.6); color:#fff; line-height:1.6;">
      <h2 id="infoTitle" style="text-align:center;color:#ffc98b;margin-top:0;"></h2>
      <img id="infoImage" src="" alt="" style="width:100%;border-radius:8px;margin:12px 0;display:none;">
      <p id="infoContent"></p>
      <div style="text-align:center;margin-top:18px;">
        <button onclick="closeInfoBox()" style="background:linear-gradient(180deg,#2e90ff,#1b6cd6);color:#fff;border:none;border-radius:10px;padding:10px 20px;font-weight:700;cursor:pointer;">ƒê√≥ng</button>
      </div>
    </div>
  </div>

<script>
/* ====== Menu toggle ====== */
(function(){
  const nav = document.getElementById('dp_menu');
  const btn = document.getElementById('dp_toggle');
  const list = document.getElementById('dp_list');
  function setState(open){
    nav.classList.toggle('show', open);
    btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    list.setAttribute('aria-hidden', open ? 'false' : 'true');
  }
  btn.addEventListener('click', ()=> setState(!nav.classList.contains('show')) );
  document.addEventListener('click', (e)=>{ if(!nav.contains(e.target)) setState(false) });
  document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') setState(false) });
  setState(false);
})();
function dpCloseMenu(){
  const nav  = document.getElementById('dp_menu');
  const btn  = document.getElementById('dp_toggle');
  const list = document.getElementById('dp_list');
  nav.classList.remove('show');
  btn.setAttribute('aria-expanded','false');
  list.setAttribute('aria-hidden','true');
};

/* ====== DATA ====== */
const DATA = {
  keyword: "B·ªòƒê·ªòIC·ª§H·ªí",
  rows: [
    { q: "Chi·∫øn th·∫Øng l·ªãch s·ª≠ n√†o k·∫øt th√∫c cu·ªôc kh√°ng chi·∫øn ch·ªëng Ph√°p c·ªßa Vi·ªát Nam?", a: "ƒêI·ªÜN BI√äN PH·ª¶", pick: 4, crossAt: 0 },
    { q: "Th√†nh ph·ªë n√†o l√† ƒë·ªãa ƒëi·ªÉm di·ªÖn ra chi·∫øn th·∫Øng 'ƒêi·ªán Bi√™n Ph·ªß tr√™n kh√¥ng' nƒÉm 1972?", a: "H√Ä N·ªòI", pick: 3, crossAt: 1 },
    { q: "C√¢u th∆° ‚ÄúTr·∫≠n ƒêi·ªán Bi√™n Ph·ªß l·∫´y l·ª´ng / Th√¢n l√†m n√™n vinh quang c·ªßa anh h√πng‚Äù n√≥i v·ªÅ ai?", a: "B·∫æ VƒÇN ƒê√ÄN", pick: 5, crossAt: 2 },
    { q: "Th·ªß lƒ©nh cu·ªôc kh·ªüi nghƒ©a Th√°i Nguy√™n nƒÉm 1917, c√≤n g·ªçi l√† Tr·ªãnh VƒÉn C·∫•n, l√† ai?", a: "ƒê·ªòI C·∫§N", pick: 1, crossAt: 3 },
    { q: "Ai l√† ng∆∞·ªùi anh h√πng ƒë√£ l·∫•y th√¢n m√¨nh ch√®n ph√°o trong chi·∫øn d·ªãch ƒêi·ªán Bi√™n Ph·ªß nƒÉm 1954?", a: "T√î Vƒ®NH DI·ªÜN", pick: 7, crossAt: 4 },
    { q: "Nguy·ªÖn T·∫•t Th√†nh l·∫•y t√™n l√† Nguy·ªÖn √Åi Qu·ªëc v√†o nƒÉm 1919 ·ªü ƒë√¢u?", a: "VECXAY", pick: 2, crossAt: 5 },
    { q: "C·∫•u tr√∫c n·ª≠a ch√¨m n·ª≠a n·ªïi, c√≥ l·ªó b·∫Øn ra c√°c h∆∞·ªõng, c·ª≠a quay v√†o trong, g·ªçi l√† g√¨?", a: "·ª§ S√öNG", pick: 0, crossAt: 6 },
    { q: "Nguy·ªÖn √Åi Qu·ªëc th√†nh l·∫≠p H·ªôi Vi·ªát Nam C√°ch m·∫°ng Thanh ni√™n ·ªü ƒë√¢u?", a: "QU·∫¢NG CH√ÇU", pick: 6, crossAt: 7 },
    { q: "Chi·∫øn d·ªãch n√†o k·∫øt th√∫c cu·ªôc kh√°ng chi·∫øn ch·ªëng M·ªπ t·∫°i Vi·ªát Nam?", a: "H·ªí CH√ç MINH", pick: 1, crossAt: 8 }
  ]
};

const DATA2 = {
  "ƒêI·ªÜN BI√äN PH·ª¶": {
    title: "Chi·∫øn th·∫Øng ƒêi·ªán Bi√™n Ph·ªß (1954)",
    content: "Chi·∫øn th·∫Øng ƒêi·ªán Bi√™n Ph·ªß ng√†y 7/5/1954 l√† m·ªëc son ch√≥i l·ªçi trong l·ªãch s·ª≠ d√¢n t·ªôc Vi·ªát Nam, k·∫øt th√∫c th·∫Øng l·ª£i cu·ªôc kh√°ng chi·∫øn ch·ªëng th·ª±c d√¢n Ph√°p, bu·ªôc Ph√°p ph·∫£i k√Ω Hi·ªáp ƒë·ªãnh Gen√®ve, c√¥ng nh·∫≠n ƒë·ªôc l·∫≠p, ch·ªß quy·ªÅn, th·ªëng nh·∫•t v√† to√†n v·∫πn l√£nh th·ªï c·ªßa Vi·ªát Nam.",
    image: "Dien_Bien_Phu.jpg"
  },
  "H√Ä N·ªòI": {
    title: "Chi·∫øn th·∫Øng 'ƒêi·ªán Bi√™n Ph·ªß tr√™n kh√¥ng' (1972)",
    content: "Trong 12 ng√†y ƒë√™m cu·ªëi nƒÉm 1972, qu√¢n v√† d√¢n Th·ªß ƒë√¥ H√† N·ªôi ƒë√£ anh d≈©ng ƒë√°nh b·∫°i cu·ªôc t·∫≠p k√≠ch chi·∫øn l∆∞·ª£c b·∫±ng B-52 c·ªßa M·ªπ, l√†m n√™n chi·∫øn th·∫Øng 'ƒêi·ªán Bi√™n Ph·ªß tr√™n kh√¥ng', bu·ªôc M·ªπ k√Ω Hi·ªáp ƒë·ªãnh Paris.",
    image: "B52_Hanoi_1972.jpg"
  },
  "B·∫æ VƒÇN ƒê√ÄN": {
    title: "Anh h√πng li·ªát sƒ© B·∫ø VƒÉn ƒê√†n",
    content: "B·∫ø VƒÉn ƒê√†n (1921‚Äì1954) l√† chi·∫øn sƒ© QƒêND Vi·ªát Nam, d√πng vai l√†m gi√° s√∫ng cho ƒë·ªìng ƒë·ªôi b·∫Øn ti√™u di·ªát ƒë·ªãch trong chi·∫øn d·ªãch ƒêi·ªán Bi√™n Ph·ªß.",
    image: "Be_Van_Dan_statue.jpg"
  },
  "ƒê·ªòI C·∫§N": {
    title: "L√£nh t·ª• kh·ªüi nghƒ©a Th√°i Nguy√™n",
    content: "ƒê·ªôi C·∫•n (Tr·ªãnh VƒÉn C·∫•n, 1881‚Äì1917) l√£nh ƒë·∫°o cu·ªôc kh·ªüi nghƒ©a Th√°i Nguy√™n, m·ªôt trong nh·ªØng cu·ªôc n·ªïi d·∫≠y l·ªõn ƒë·∫ßu th·∫ø k·ª∑ XX.",
    image: "Thai_Nguyen_revolt.jpg"
  },
  "T√î Vƒ®NH DI·ªÜN": {
    title: "Anh h√πng li·ªát sƒ© T√¥ Vƒ©nh Di·ªán",
    content: "Trong chi·∫øn d·ªãch ƒêi·ªán Bi√™n Ph·ªß, khi ph√°o tr∆∞·ª£t xu·ªëng v·ª±c, anh ƒë√£ l·∫•y th√¢n m√¨nh ch√®n ph√°o, hy sinh ƒë·ªÉ c·ª©u v≈© kh√≠ cho ƒë∆°n v·ªã.",
    image: "To_Vinh_Dien_statue.jpg"
  },
  "VECXAY": {
    title: "H·ªôi ngh·ªã Versailles 1919",
    content: "NƒÉm 1919, Nguy·ªÖn T·∫•t Th√†nh l·∫•y t√™n Nguy·ªÖn √Åi Qu·ªëc v√† g·ª≠i 'Y√™u s√°ch c·ªßa nh√¢n d√¢n An Nam' t·ªõi H·ªôi ngh·ªã Versailles.",
    image: "Treaty_of_Versailles_signing.jpg"
  },
  "·ª§ S√öNG": {
    title: "C√¥ng s·ª± ph√≤ng th·ªß ‚Äî ·ª• s√∫ng",
    content: "·ª§ s√∫ng l√† c·∫•u tr√∫c n·ª≠a ch√¨m n·ª≠a n·ªïi, che ch·∫Øn x·∫° th·ªß v√† tƒÉng kh·∫£ nƒÉng ph√≤ng th·ªß trong chi·∫øn ƒë·∫•u.",
    image: "Bunker_Military.jpg"
  },
  "QU·∫¢NG CH√ÇU": {
    title: "N∆°i th√†nh l·∫≠p H·ªôi VN C√°ch m·∫°ng Thanh ni√™n",
    content: "NƒÉm 1925, Nguy·ªÖn √Åi Qu·ªëc th√†nh l·∫≠p H·ªôi VN C√°ch m·∫°ng Thanh ni√™n t·∫°i Qu·∫£ng Ch√¢u (Trung Qu·ªëc).",
    image: "Guangzhou_old_town.jpg"
  },
  "H·ªí CH√ç MINH": {
    title: "Chi·∫øn d·ªãch H·ªì Ch√≠ Minh (1975)",
    content: "Chi·∫øn d·ªãch H·ªì Ch√≠ Minh m√πa xu√¢n 1975 k·∫øt th√∫c th·∫Øng l·ª£i v·ªõi s·ª± ki·ªán 30/4, th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc.",
    image: "Tanks_at_Presidential_Palace_Saigon_1975.jpg"
  }
};

/* ====== Helpers ====== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function normalizeVN(str){ return (str||'').toUpperCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/ƒê/g,'D') }
function stripSpaces(s){ return (s||'').replace(/\s+/g,''); }
function toUpperKeepVN(s){ return (s||'').toLocaleUpperCase('vi-VN'); }
function keyNormalized(){ return stripSpaces(normalizeVN(DATA.keyword||'')); }

let currentRow = null;
let solved = new Set();
let acroLetters = [];
let keywordSolved = false;

/* ====== Build UI ====== */
function build(){
  const keyword = $('#keyword'); keyword.innerHTML='';
  const L = keyNormalized().length; acroLetters = Array(L).fill('?');
  for(let i=0;i<L;i++){
    const s = document.createElement('div');
    s.className='keyword-cell'; s.dataset.col=i; s.textContent='?';
    keyword.appendChild(s);
  }

  const questions = $('#questions'); questions.innerHTML = '';
  DATA.rows.forEach((item, idx)=>{
    const questionItem = document.createElement('div'); questionItem.className = 'question-item'; questionItem.dataset.idx = idx;
    const questionNumber = document.createElement('div'); questionNumber.className = 'question-number'; questionNumber.innerHTML = `<button class="question-btn" data-open="${idx}">C√ÇU ${idx+1}</button>`;
    const questionContent = document.createElement('div'); questionContent.className = 'question-content';
    const questionPlaceholder = document.createElement('div'); questionPlaceholder.className = 'question-placeholder'; questionPlaceholder.textContent = `B·∫•m ƒë·ªÉ xem c√¢u h·ªèi ${idx+1}`;
    const answerCells = document.createElement('div'); answerCells.className = 'answer-cells';
    const disp = stripSpaces(toUpperKeepVN(item.a));
    for(let i=0;i<disp.length;i++){
      const span = document.createElement('div'); span.className = 'answer-cell'; span.dataset.col = i; if(i===item.pick) span.classList.add('pivot'); span.textContent = '¬∑'; answerCells.appendChild(span);
    }
    questionContent.appendChild(questionPlaceholder);
    questionContent.appendChild(answerCells);
    questionItem.appendChild(questionNumber);
    questionItem.appendChild(questionContent);
    questions.appendChild(questionItem);
  });

  const ladder = $('#ladder'); ladder.innerHTML = '';
  for(let i=0;i<DATA.rows.length;i++){
    const step = document.createElement('button'); step.className='btn-secondary'; step.dataset.open=i; step.textContent = `C√ÇU ${i+1}`; ladder.appendChild(step);
  }

  $('#finalMsg').textContent = "Tr·∫£ l·ªùi ƒë√∫ng m·ªói c√¢u h·ªèi s·∫Ω h√© l·ªô m·ªôt ch·ªØ c√°i trong t·ª´ kh√≥a";
  $('#answersPanel').classList.remove('active');
}

function scrollToKeyword(){ const el = $('#keyword'); if(!el) return; el.scrollIntoView({ behavior: 'smooth', block: 'start' }); }

function openQA(idx){
  currentRow = idx;
  $('#qa').classList.add('active');
  $('#qtext').textContent = DATA.rows[idx].q;
  $('#answer').value='';
  $('#feedback').textContent='';
  $('#answer').focus();
  $('#qa').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function checkAnswer(){
  if(currentRow===null) return;
  const row = DATA.rows[currentRow];
  const user = stripSpaces(normalizeVN($('#answer').value));
  if(!user){ $('#feedback').textContent='Vui l√≤ng nh·∫≠p ƒë√°p √°n!'; return; }
  const ok = user === stripSpaces(normalizeVN(row.a));

  if (ok) {
    revealRow(currentRow);
    const idx = currentRow;
    const answerText = DATA.rows[idx].a;

    // Hi·ªáu ·ª©ng nh·ªè xong m·ªõi m·ªü info
    celebrateSmall().then(() => {
      showInfo(answerText);
      setTimeout(() => {
        $('#qa').classList.remove('active');
        currentRow = null;
      }, 200);
    });

    $('#feedback').textContent = 'Ch√≠nh x√°c! ƒê√°p √°n ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã.';
    setTimeout(scrollToKeyword, 1300);
  } else {
    $('#feedback').textContent = 'Ch∆∞a ch√≠nh x√°c. H√£y th·ª≠ l·∫°i!';
    $('#answer').classList.add('shake'); setTimeout(()=>$('#answer').classList.remove('shake'),400);
  }
}

function revealRow(idx){
  const questionItem = document.querySelector(`.question-item[data-idx="${idx}"]`); if(!questionItem) return;
  const row = DATA.rows[idx];
  const cells = questionItem.querySelectorAll('.answer-cell');
  const disp = stripSpaces(toUpperKeepVN(row.a));
  cells.forEach((c,i)=>{ c.textContent = disp[i]; c.classList.add('revealed'); });
  questionItem.classList.add('solved');
  solved.add(idx);

  const slots = Array.from(document.querySelectorAll('#keyword .keyword-cell'));
  const col = row.crossAt;
  if (col < slots.length){
    const pivotChar = disp[row.pick] || '?';
    acroLetters[col] = pivotChar;
    const slot = slots[col]; slot.textContent = pivotChar; slot.classList.add('ready');
  }
}

function restart(){
  currentRow=null; solved=new Set(); keywordSolved=false; build();
  document.getElementById('qa').classList.remove('active');
  document.getElementById('finalGuess').value='';
  document.getElementById('finalMsg').textContent='Tr·∫£ l·ªùi ƒë√∫ng m·ªói c√¢u h·ªèi s·∫Ω h√© l·ªô m·ªôt ch·ªØ c√°i trong t·ª´ kh√≥a';
}

/* ====== T·ª™ KH√ìA ====== */
function guessFinal(){
  const guess = stripSpaces(normalizeVN(document.getElementById('finalGuess').value));
  if(!guess){ document.getElementById('finalMsg').textContent='Nh·∫≠p t·ª´ kh√≥a c·∫ßn ƒëo√°n nh√©!'; return; }
  const target = keyNormalized();
  if(guess === target){
    fillKeyword(stripSpaces(toUpperKeepVN(DATA.keyword)));
    DATA.rows.forEach((_, i)=>{ if(!solved.has(i)) revealRow(i); });
    document.querySelectorAll('.question-item').forEach(q=>{ q.style.display = 'block'; q.classList.add('revealed'); });
    document.getElementById('finalMsg').textContent = 'Tuy·ªát v·ªùi! B·∫°n ƒë√£ ƒëo√°n ƒë√∫ng t·ª´ kh√≥a: ' + DATA.keyword;
    celebrateWin();
  } else {
    document.getElementById('finalMsg').textContent = 'Ch∆∞a ƒë√∫ng. Th·ª≠ l·∫°i nh√©!';
  }
}

function fillKeyword(target){
  const slots=Array.from(document.querySelectorAll('#keyword .keyword-cell'));
  const L=Math.min(target.length,slots.length);
  for(let i=0;i<L;i++){
    slots[i].textContent=target[i];
    slots[i].classList.add('ready');
    acroLetters[i]=target[i];
  }
}

function showAllAnswers(){
  const answersList = document.getElementById('answersList'); answersList.innerHTML = '';
  DATA.rows.forEach((item, idx) => {
    const answerItem = document.createElement('div');
    answerItem.className = 'answer-item';
    answerItem.innerHTML = `<div class="answer-question">C√¢u ${idx+1}: ${item.q}</div><div class="answer-text">${item.a}</div>`;
    answersList.appendChild(answerItem);
  });
  document.getElementById('answersPanel').classList.add('active');
}

/* ====== Hi·ªáu ·ª©ng ====== */
function celebrate(){
  const confetti=document.createElement('div');
  confetti.className = 'confetti';
  confetti.style.cssText = 'position:fixed; inset:0; z-index:5000; pointer-events:none;';
  confetti.innerHTML = `<svg width="100%" height="100%" preserveAspectRatio="none">
    ${[...Array(100)].map(()=>{
      const x=Math.random()*100,d=6+Math.random()*10,dur=2+Math.random()*1.8;
      return `<rect x="${x}%" y="-10" width="${d}" height="${d}" rx="2" ry="2" fill="url(#g)" style="animation:f ${dur}s linear forwards; opacity:.9"/>`;
    }).join('')}
    <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#22d3ee"/><stop offset="50%" stop-color="#a78bfa"/><stop offset="100%" stop-color="#4a7c1f"/></linearGradient></defs>
    <style>@keyframes f { to { transform: translateY(110vh) rotate(360deg);} }</style>
  </svg>`;
  document.body.appendChild(confetti);
  setTimeout(()=>confetti.remove(),3500);
}

// Hi·ªáu ·ª©ng mini ‚Äî ƒë·∫£m b·∫£o hi·ªÉn th·ªã tr√™n c√πng & full m√†n
function celebrateSmall(){
  return new Promise((resolve) => {
    const DURATION = 2200; // d√†i h∆°n max animation (~2s)
    const burst = document.createElement('div');
    burst.className='burst';
    burst.style.cssText = 'position:fixed; inset:0; z-index:4500; pointer-events:none;';
    burst.innerHTML=`<svg width="100%" height="100%" preserveAspectRatio="none">
      ${[...Array(30)].map(()=>{const x=Math.random()*100,y=Math.random()*10,d=1+Math.random();return `<circle cx="${x}%" cy="${y}%" r="3" fill="hsl(${Math.random()*360},80%,60%)" style="animation:fly ${d}s ease-out forwards;"/>`;}).join('')}
      <style>@keyframes fly{to{transform:translateY(80vh) scale(0.8);opacity:0}}</style>
    </svg>`;
    document.body.appendChild(burst);
    setTimeout(()=>{ burst.remove(); resolve(); }, DURATION);
  });
}

function showInfo(answer){
  const info = DATA2[answer];
  if(!info) return;
  document.getElementById('infoTitle').textContent = info.title || '';
  document.getElementById('infoContent').textContent = info.content || '';
  const img = document.getElementById('infoImage');

  // Fallback ·∫£nh + retry khi online
  let pendingUrl = info.image || null;
  const FALLBACK_SVG = 'data:image/svg+xml;utf8,' + encodeURIComponent(
    `<svg xmlns="http://www.w3.org/2000/svg" width="800" height="450"><rect width="100%" height="100%" fill="#0d203f"/><text x="50%" y="50%" fill="#cfe0ff" font-size="24" font-family="Arial, sans-serif" dominant-baseline="middle" text-anchor="middle">Kh√¥ng th·ªÉ t·∫£i ·∫£nh (offline)</text></svg>`
  );
  function setInfoImage(url){
    img.onload = ()=>{ img.style.display='block'; };
    img.onerror = ()=>{ if (img.src !== FALLBACK_SVG) { img.src = FALLBACK_SVG; } img.style.display='block'; };
    img.src = url;
  }
  if (pendingUrl && navigator.onLine){ setInfoImage(pendingUrl); } else { setInfoImage(FALLBACK_SVG); }
  window.addEventListener('online', ()=>{ if (pendingUrl) setInfoImage(pendingUrl); }, {once:true});

  document.getElementById('infoBox').style.display='flex';
}
function closeInfoBox(){ document.getElementById('infoBox').style.display='none'; }

function celebrateBig(){
  const overlay = document.createElement('div');
  overlay.style = ["position:fixed","inset:0","background:rgba(0,0,0,0.6)","z-index:5000","display:flex","align-items:center","justify-content:center","flex-direction:column","animation: fadeOut 4s ease forwards"].join(';');
  overlay.innerHTML = `
    <h1 style="color:#ffd700;font-size:clamp(40px,6vw,70px);text-shadow:0 0 20px #fff,0 0 40px #ff9;font-weight:900;margin:0 12px;">üéâ XU·∫§T S·∫ÆC üéâ</h1>
    <svg width="100%" height="100%" preserveAspectRatio="none" style="position:absolute;inset:0;">
      ${[...Array(160)].map(()=>`<circle cx='${Math.random()*100}%' cy='${Math.random()*10}%' r='4' fill='hsl(${Math.random()*360},90%,60%)' style='animation:fly 3s ease-out forwards;'/>`).join('')}
      <style>@keyframes fly{to{transform:translateY(100vh) scale(.6);opacity:0}}@keyframes fadeOut{0%,90%{opacity:1}100%{opacity:0}}</style>
    </svg>`;
  document.body.appendChild(overlay);
  setTimeout(()=>overlay.remove(),4000);
}

function celebrateWin(){ celebrate(); setTimeout(celebrateBig, 800); }

/* ====== S·ª± ki·ªán ====== */
function showRules(){ document.getElementById('rulesModal').style.display='flex'; }
function closeRules(){ document.getElementById('rulesModal').style.display='none'; }

// Listeners
$('#questions').addEventListener('click', e=>{ const item=e.target.closest('.question-item'); if(item){ openQA(+item.dataset.idx); }});
$('#btnCheck').addEventListener('click', checkAnswer);
$('#answer').addEventListener('keydown', e=>{ if(e.key==='Enter') checkAnswer(); });
$('#btnClose').addEventListener('click', ()=>{ $('#qa').classList.remove('active'); currentRow=null; scrollToKeyword(); });
$('#btnRestart').addEventListener('click', restart);
$('#btnFinal').addEventListener('click', guessFinal);
$('#ladder').addEventListener('click', e=>{ const step=e.target.closest('button[data-open]'); if(step){ openQA(+step.dataset.open); } });

// Init
build();
</script>
</body>
</html>
