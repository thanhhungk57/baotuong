<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>√î Ch·ªØ Qu√¢n ƒê·ªôi NDVN</title>
  <style>
    :root{
      --bg:#0a1429; --panel:#0d1a33; --muted:#8fa3c7; --text:#e1eafc;
      --line:#1d2c4a; --accent:#22d3ee; --accent2:#a78bfa;
      --army-green:#2d5016; --army-dark:#1a2f0d; --army-light:#4a7c1f;
      --tile1:#7a2a00; --tile2:#bf4b0a; --tileBorder:#ffc98b;
      --tile:clamp(32px, 7vw, 44px); --gap:clamp(3px, 0.8vw, 5px);
    }
    *{box-sizing:border-box; margin:0; padding:0;}
    html,body{height:100%;}
    html{scroll-behavior:smooth;}
    body{
      font-family:'Segoe UI', system-ui, Roboto, sans-serif; 
      background:radial-gradient(ellipse at top, #0f2248 0%, #0a142a 60%, var(--bg) 100%); 
      color:var(--text); 
      padding:12px;
      overflow-x: hidden;
      line-height:1.5;
    }
    .app{
      width:100%; 
      max-width:1200px; 
      margin:0 auto;
    }
    
    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      text-align: center;
    }
    .logo {
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--army-green), var(--army-light));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid #ffc98b;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .logo-inner {
      width: 50px;
      height: 50px;
      background: #ffc98b;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: var(--army-dark);
      font-size: 24px;
    }
    .title-section {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .title {
      font-size: clamp(20px, 3vw, 28px);
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      margin-bottom: 4px;
      text-align: center;
    }
    .subtitle {
      font-size: clamp(13px, 1.8vw, 16px);
      color: #cfe0ff;
      text-align: center;
    }

    /* Layout ch√≠nh */
    .main-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .keyword-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    
    .keyword-title {
      font-size: clamp(16px, 2vw, 20px);
      color: #ffc98b;
      margin: 0;
      text-align: center;
    }
    
    .keyword-row {
      display: flex;
      gap: var(--gap);
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .keyword-cell {
      width: var(--tile);
      height: var(--tile);
      border-radius: 8px;
      border: 2px solid var(--tileBorder);
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--army-dark), var(--army-green));
      font-weight: 900;
      font-size: clamp(16px, 3.5vw, 20px);
      color: #ffc98b;
      text-shadow: 0 1px 2px #000;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .keyword-cell.ready {
      box-shadow: 0 0 0 3px var(--accent) inset, 0 4px 8px rgba(0,0,0,0.3);
    }

    /* Grid ch√≠nh */
    .crossword-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    
    @media (min-width: 900px) {
      .crossword-grid {
        grid-template-columns: 1fr 280px;
      }
    }

    /* Panel c√¢u h·ªèi - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .questions-panel {
      background: linear-gradient(160deg, #0d1830, #0a1426);
      border: 1px solid #2a3a5a;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      position: relative;
      overflow: hidden;
      width: 100%;
    }
    
    .questions-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--army-green), var(--army-light));
    }
    
    /* Questions title - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .questions-title {
      margin: 0 0 12px;
      font-size: 18px;
      color: #ffc98b;
      text-align: center;
      width: 100%;
      font-weight: 600;
      line-height: 1.2;
      padding: 0 8px;
    }
    
    .questions-list {
      display: grid;
      gap: 12px;
      width: 100%;
    }
    
    /* Question item - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .question-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px;
      border: 1px dashed #2a3a5a;
      border-radius: 10px;
      transition: all 0.3s ease;
      cursor: pointer;
      background: rgba(255,255,255,0.03);
      width: 100%;
      box-sizing: border-box;
      max-width: 100%;
      overflow: hidden;
    }
    
    @media (min-width: 768px) {
      .question-item {
        display: grid;
        grid-template-columns: 120px 1fr;
        align-items: start;
        gap: 12px;
      }
    }
    
    .question-item:hover {
      border-color: #3a4a7a;
      background: rgba(255, 255, 255, 0.07);
    }
    
    .question-item.solved {
      border-style: solid;
      border-color: #2a5c2a;
      background: rgba(42, 92, 42, 0.15);
    }
    
    /* Question number - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .question-number {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 0;
      width: 100%;
      box-sizing: border-box;
    }
    
    @media (min-width: 768px) {
      .question-number {
        justify-content: flex-start;
        margin-bottom: 0;
        width: auto;
        min-width: 120px;
      }
    }
    
    /* Question btn - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .question-btn {
      padding: 10px 14px;
      border: 1px solid #3a4a6a;
      border-radius: 8px;
      background: linear-gradient(135deg, #1a2f0d, #2d5016);
      color: #ffc98b;
      cursor: pointer;
      font-size: 13px;
      font-family: Arial, sans-serif;
      white-space: nowrap;
      font-weight: 600;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: all 0.2s;
      width: 100%;
      max-width: 120px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 36.8px;
      box-sizing: border-box;
    }
    
    @media (max-width: 767px) {
      .question-btn {
        max-width: 100px;
        padding: 8px 12px;
        font-size: 12px;
        height: 36px;
      }
    }
    
    .question-btn:hover {
      border-color: #4a5a7a;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    /* Question content - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .question-content {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
      overflow: hidden;
      align-items: center;
      box-sizing: border-box;
    }
    
    @media (min-width: 768px) {
      .question-content {
        align-items: flex-start;
        min-width: 0;
      }
    }
    
    /* Question placeholder - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .question-placeholder {
      color: #8fa3c7;
      font-style: italic;
      text-align: center;
      font-size: clamp(13px, 1.6vw, 15px);
      line-height: 1.4;
      padding: 4px 0;
      width: 100%;
      box-sizing: border-box;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    @media (min-width: 768px) {
      .question-placeholder {
        text-align: left;
        white-space: normal;
      }
    }
    
    /* Answer cells - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .answer-cells {
      display: flex;
      flex-wrap: nowrap;
      gap: var(--gap);
      overflow-x: auto;
      padding: 4px 2px 8px 2px;
      width: 100%;
      -webkit-overflow-scrolling: touch;
      justify-content: flex-start;
      box-sizing: border-box;
    }
    
    .answer-cells::-webkit-scrollbar {
      height: 6px;
    }
    
    .answer-cells::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
    }
    
    .answer-cells::-webkit-scrollbar-thumb {
      background: var(--army-light);
      border-radius: 3px;
    }
    
    /* Answer cell - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .answer-cell {
      width: 30px;
      height: 30px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      letter-spacing: 0.06em;
      font-size: 12px;
      background: linear-gradient(135deg, var(--tile2), var(--tile1));
      color: #FFFAF0;
      text-shadow: 0 1px 2px #000;
      border: 2px solid var(--tileBorder);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3), inset 0 0 0 1px rgba(255,255,255,0.1);
      flex-shrink: 0;
      min-width: 0;
    }
    
    @media (min-width: 480px) {
      .answer-cell {
        width: clamp(32px, 7vw, 40px);
        height: clamp(32px, 7vw, 40px);
        font-size: clamp(12px, 2.8vw, 16px);
      }
    }
    
    .answer-cell.pivot {
      box-shadow: 0 0 0 3px #40e0ff inset, 0 0 8px #1bdfff;
    }
    
    .answer-cell.revealed {
      animation: pop 0.3s ease;
    }
    
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    /* Panel ƒëi·ªÅu khi·ªÉn - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    .control-panel {
      background: linear-gradient(160deg, #0d1830, #0a1426);
      border: 1px solid #2a3a5a;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: relative;
      overflow: hidden;
      width: 100%;
      box-sizing: border-box;
    }
    
    .control-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
    }
    
    .control-title {
      margin: 0 0 12px;
      font-size: clamp(16px, 2vw, 20px);
      color: #ffc98b;
      text-align: center;
      width: 100%;
    }
    
    .control-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }
    
    .section-title {
      font-size: 14px;
      color: #cfe0ff;
      margin-bottom: 6px;
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }
    
    input[type="text"] {
      background: #0a1122;
      color: var(--text);
      border: 1px solid #2a3a5a;
      border-radius: 8px;
      padding: 10px 12px;
      outline: none;
      font-size: 14px;
      width: 100%;
      transition: all 0.2s;
      box-sizing: border-box;
    }
    
    input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.2);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #0ea5e9, #22d3ee);
      color: #051018;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      font-size: clamp(13px, 1.6vw, 15px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: all 0.2s;
      width: 100%;
      box-sizing: border-box;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #1a2f0d, #2d5016);
      color: #ffc98b;
      border: 1px solid #3a4a6a;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      font-size: clamp(13px, 1.6vw, 15px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: all 0.2s;
      width: 100%;
      box-sizing: border-box;
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    }
    
    .message {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      line-height: 1.4;
    }

    /* Q&A Panel */
    .qa-panel {
      margin-top: 16px;
      display: none;
      width: 100%;
    }
    
    .qa-panel.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .qa-question {
      padding: 14px 16px;
      border: 1px solid #2a3a5a;
      border-radius: 10px;
      background: rgba(10, 17, 34, 0.7);
      font-size: clamp(14px, 1.6vw, 16px);
      line-height: 1.5;
      margin-bottom: 14px;
      width: 100%;
      box-sizing: border-box;
    }
    
    .qa-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }
    
    .qa-input-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      width: 100%;
    }
    
    @media (max-width: 480px) {
      .qa-input-group {
        flex-direction: column;
      }
      
      .qa-input-group button {
        width: 100%;
      }
    }
    
    .qa-feedback {
      font-size: 13px;
      color: var(--muted);
      min-height: 18px;
      text-align: center;
    }

    /* Panel ƒë√°p √°n ƒë·∫ßy ƒë·ªß */
    .answers-panel {
      margin-top: 20px;
      display: none;
      width: 100%;
    }
    
    .answers-panel.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    .answers-title {
      margin: 0 0 14px;
      font-size: clamp(16px, 2vw, 20px);
      color: #ffc98b;
      text-align: center;
      width: 100%;
    }
    
    .answer-item {
      margin-bottom: 14px;
      padding: 14px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-left: 4px solid var(--army-light);
      width: 100%;
      box-sizing: border-box;
    }
    
    .answer-question {
      font-weight: bold;
      margin-bottom: 6px;
      font-size: clamp(13px, 1.6vw, 15px);
      color: #cfe0ff;
    }
    
    .answer-text {
      color: var(--accent);
      font-size: clamp(13px, 1.6vw, 15px);
      font-weight: 600;
    }

    /* Footer */
    .footer {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      color: #8fa3c7;
      font-size: 12px;
      border-top: 1px solid #2a3a5a;
      padding-top: 12px;
      width: 100%;
    }
    
    .footer-tip {
      text-align: center;
      line-height: 1.5;
      width: 100%;
    }
    
    .footer-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      width: 100%;
    }

    /* Ladder */
    .ladder {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
      gap: 8px;
      width: 100%;
    }

    /* Hi·ªáu ·ª©ng */
    .shake {
      animation: shake 0.4s ease;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }
    
    /* T·ªëi ∆∞u cho mobile - ƒê√É S·ª¨A KH√îNG TR√ÄN */
    @media (max-width: 767px) {
      .questions-panel {
        padding: 10px;
      }
      
      .question-item {
        padding: 10px;
        gap: 6px;
      }
      
      .footer-controls {
        flex-direction: column;
        align-items: center;
      }
      
      .ladder {
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      }
      
      .control-panel {
        padding: 12px;
      }
      
      .questions-title {
        font-size: 16px;
        margin: 0 0 12px;
        padding: 0 4px;
      }
      
      .question-content {
        padding: 0 4px;
      }
      
      .answer-cells {
        padding: 4px 1px 8px 1px;
      }
    }
    
    @media (max-width: 480px) {
      .header {
        flex-direction: column;
        gap: 10px;
      }
      
      .logo {
        width: 60px;
        height: 60px;
      }
      
      .logo-inner {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
      
      .questions-panel {
        padding: 8px;
        border-radius: 10px;
      }
      
      .question-item {
        padding: 8px;
        border-radius: 8px;
      }
      
      .answer-cells {
        gap: 2px;
        padding: 2px 0px 6px 0px;
      }
      
      .question-btn {
        max-width: 90px;
        padding: 8px 10px;
        font-size: 12px;
        height: 34px;
      }
      
      .questions-title {
        padding: 0 2px;
      }
    }
    
    /* Hi·ªáu ·ª©ng confetti */
    .confetti {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9999;
    }
.logo {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #2d5016, #1a2f0d);
  border: 3px solid #ffc98b;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.35);
  overflow: hidden; /* ‚ú® quan tr·ªçng: gi·ªõi h·∫°n h√¨nh kh√¥ng tr√†n */
}

.logo-img {
  width: 85%;
  height: 85%;
  object-fit: contain; /* gi·ªØ nguy√™n t·ª∑ l·ªá logo */
  border-radius: 50%;
  background-color: #fff; /* n·ªÅn s√°ng nh·∫π gi√∫p n·ªïi b·∫≠t */
  padding: 4px; /* kho·∫£ng ƒë·ªám */
  box-shadow: inset 0 0 4px rgba(0,0,0,0.3);
  transition: transform 0.3s ease;
}

.logo:hover .logo-img {
  transform: scale(1.05);
}

  
.home-btn {
  position: fixed;
  top: 12px;
  right: 12px;
  background: #007bff;
  color: #fff;
  font-weight: bold;
  padding: 10px 16px;
  border-radius: 8px;
  text-decoration: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  font-size: 15px;
  z-index: 1000;
  transition: background 0.3s;
}
.home-btn:hover {
  background: #0056b3;
}

</style>
</head>
<body>
  <a id="homeBtn" href="#" class="home-btn">üè† Trang ch·ªß</a>
  <div class="app">
    <div class="header">
      <div class="logo">
  <img src="logodoan.png" alt="Logo Qu√¢n ƒê·ªôi" class="logo-img">
</div>
      <div class="title-section">
        <h1 class="title">√î CH·ªÆ QU√ÇN ƒê·ªòI NH√ÇN D√ÇN VI·ªÜT NAM</h1>
        <div class="subtitle">Truy·ªÅn th·ªëng v·∫ª vang - Chi·∫øn c√¥ng l·ª´ng l·∫´y</div>
      </div>
    </div>
    
    <div class="main-container">
      <div class="keyword-section">
        <h2 class="keyword-title">T·ª™ KH√ìA D·ªåC</h2>
        <div id="keyword" class="keyword-row"></div>
        <div class="input-group">
          <input id="finalGuess" type="text" placeholder="Nh·∫≠p t·ª´ kh√≥a d·ªçc..." />
          <button id="btnFinal" class="btn-primary">KI·ªÇM TRA T·ª™ KH√ìA</button>
          <div id="finalMsg" class="message">Tr·∫£ l·ªùi ƒë√∫ng m·ªói c√¢u h·ªèi s·∫Ω h√© l·ªô m·ªôt ch·ªØ c√°i trong t·ª´ kh√≥a</div>
        </div>
      </div>
      
      <div class="crossword-grid">
        <section class="questions-panel">
          <h2 class="questions-title">C√ÇU H·ªéI √î CH·ªÆ</h2>
          <div id="questions" class="questions-list"></div>
          
          <div id="qa" class="qa-panel">
            <div id="qtext" class="qa-question"></div>
            <div class="qa-controls">
              <div class="qa-input-group">
                <input id="answer" type="text" placeholder="Nh·∫≠p ƒë√°p √°n (c√≥ th·ªÉ kh√¥ng d·∫•u)..." />
                <button id="btnCheck" class="btn-primary">KI·ªÇM TRA</button>
                <button id="btnClose" class="btn-secondary">ƒê√ìNG</button>
              </div>
              <div id="feedback" class="qa-feedback"></div>
            </div>
          </div>
          
          <div id="answersPanel" class="answers-panel">
            <h2 class="answers-title">ƒê√ÅP √ÅN HO√ÄN CH·ªàNH</h2>
            <div id="answersList"></div>
          </div>
        </section>
        
        <aside class="control-panel">
          <h2 class="control-title">ƒêI·ªÄU KHI·ªÇN</h2>
          
          <div class="control-section">
            <div class="section-title">Ch·ªçn c√¢u h·ªèi</div>
            <div id="ladder" class="ladder"></div>
          </div>
          
          <div class="control-section">
            <div class="section-title">H∆∞·ªõng d·∫´n</div>
            <div class="message">
              T·ª´ kh√≥a d·ªçc ƒë∆∞·ª£c t·∫°o th√†nh t·ª´ c√°c ch·ªØ c√°i giao nhau c·ªßa ƒë√°p √°n ngang.
            </div>
            <button id="btnRestart" class="btn-secondary">CH∆†I L·∫†I</button>
          </div>
        </aside>
      </div>
      
      <div class="footer">
        <div class="footer-tip">
          <b>M·∫πo ch∆°i:</b> M·ªói ƒë√°p √°n ƒë√∫ng s·∫Ω ti·∫øt l·ªô m·ªôt ch·ªØ c√°i trong t·ª´ kh√≥a d·ªçc. H√£y quan s√°t k·ªπ v·ªã tr√≠ c√°c ch·ªØ c√°i giao nhau.
        </div>
      </div>
    </div>
  </div>

<script>

const DATA = {
  keyword: "B·ªòƒê·ªòIC·ª§H·ªí", // B ·ªò ƒê ·ªò I C ·ª§ H ·ªí
  rows: [
    {
      q: "Chi·∫øn th·∫Øng l·ªãch s·ª≠ n√†o k·∫øt th√∫c cu·ªôc kh√°ng chi·∫øn ch·ªëng Ph√°p c·ªßa Vi·ªát Nam?",
      a: "ƒêI·ªÜN BI√äN PH·ª¶",
      pick: 0,   // ch·ªØ 'B'
      crossAt: 0 // c·ªôt B
    },
    {
      q: "Th√†nh ph·ªë n√†o l√† ƒë·ªãa ƒëi·ªÉm di·ªÖn ra chi·∫øn th·∫Øng 'ƒêi·ªán Bi√™n Ph·ªß tr√™n kh√¥ng' nƒÉm 1972?",
      a: "H√Ä N·ªòI",
      pick: 1,   // '·ªò'
      crossAt: 1 // c·ªôt ·ªò
    },
    {
      q: "C√¢u th∆° ‚ÄúTr·∫≠n ƒêi·ªán Bi√™n Ph·ªß l·∫´y l·ª´ng / Th√¢n l√†m n√™n vinh quang c·ªßa anh h√πng‚Äù n√≥i v·ªÅ ai?",
      a: "B·∫æ VƒÇN ƒê√ÄN",
      pick: 0,   // 'ƒê'
      crossAt: 2 // c·ªôt ƒê
    },
    {
      q: "Th·ªß lƒ©nh cu·ªôc kh·ªüi nghƒ©a Th√°i Nguy√™n nƒÉm 1917, c√≤n g·ªçi l√† Tr·ªãnh VƒÉn C·∫•n, l√† ai?",
      a: "ƒê·ªòI C·∫§N",
      pick: 0,   // 'ƒê'
      crossAt: 3 // c·ªôt ·ªò
    },
    {
      q: "Nguy·ªÖn T·∫•t Th√†nh l·∫•y t√™n l√† Nguy·ªÖn √Åi Qu·ªëc v√†o nƒÉm 1919 ·ªü ƒë√¢u?",
      a: "VECXAY",
      pick: 0,   // 'I'
      crossAt: 4 // c·ªôt I
    },
    {
      q: "C·∫•u tr√∫c n·ª≠a ch√¨m n·ª≠a n·ªïi, c√≥ l·ªó b·∫Øn ra c√°c h∆∞·ªõng, c·ª≠a quay v√†o trong, g·ªçi l√† g√¨?",
      a: "·ª§ S√öNG",
      pick: 0,   // 'C'
      crossAt: 5 // c·ªôt C
    },
    {
      q: "Nguy·ªÖn √Åi Qu·ªëc th√†nh l·∫≠p H·ªôi Vi·ªát Nam C√°ch m·∫°ng Thanh ni√™n ·ªü ƒë√¢u?",
      a: "QU·∫¢NG CH√ÇU",
      pick: 0,   // '·ª§'
      crossAt: 6 // c·ªôt ·ª§
    },
    {
      q: "Chi·∫øn d·ªãch n√†o k·∫øt th√∫c cu·ªôc kh√°ng chi·∫øn ch·ªëng M·ªπ t·∫°i Vi·ªát Nam?",
      a: "H·ªí CH√ç MINH",
      pick: 0,   // 'H'
      crossAt: 7 // c·ªôt H
    }
  ]
};


const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function normalizeVN(str){
  return (str||'')
    .toUpperCase()
    .normalize('NFD').replace(/\p{Diacritic}/gu,'')
    .replace(/ƒê/g,'D')
}
function stripSpaces(s){ return (s||'').replace(/\s+/g,''); }
function toUpperKeepVN(s){ return (s||'').toLocaleUpperCase('vi-VN'); }
function keyNormalized(){ return stripSpaces(normalizeVN(DATA.keyword||'')); }

let currentRow = null;
let solved = new Set();
let acroLetters = [];
let keywordSolved = false;

function build(){
  const keyword = $('#keyword'); 
  keyword.innerHTML='';
  const L = keyNormalized().length; 
  acroLetters = Array(L).fill('?');
  
  for(let i=0;i<L;i++){
    const s = document.createElement('div'); 
    s.className='keyword-cell'; 
    s.dataset.col=i; 
    s.textContent='?'; 
    keyword.appendChild(s);
  }

  const questions = $('#questions'); 
  questions.innerHTML = '';
  
  DATA.rows.forEach((item, idx)=>{
    const questionItem = document.createElement('div'); 
    questionItem.className = 'question-item'; 
    questionItem.dataset.idx = idx;
    
    const questionNumber = document.createElement('div'); 
    questionNumber.className = 'question-number'; 
    questionNumber.innerHTML = `<button class="question-btn" data-open="${idx}">C√ÇU ${idx+1}</button>`;
    
    const questionContent = document.createElement('div'); 
    questionContent.className = 'question-content';
    
    const questionPlaceholder = document.createElement('div'); 
    questionPlaceholder.className = 'question-placeholder'; 
    questionPlaceholder.textContent = `B·∫•m ƒë·ªÉ xem c√¢u h·ªèi ${idx+1}`;
    
    const answerCells = document.createElement('div'); 
    answerCells.className = 'answer-cells';
    
    const disp = stripSpaces(toUpperKeepVN(item.a));
    const offset = (item.crossAt - item.pick);
    answerCells.style.setProperty('--offset', offset);
    
    for(let i=0;i<disp.length;i++){
      const span = document.createElement('div'); 
      span.className = 'answer-cell'; 
      span.dataset.col = i;
      if(i===item.pick) span.classList.add('pivot');
      span.textContent = '¬∑';
      answerCells.appendChild(span);
    }
    
    questionContent.appendChild(questionPlaceholder);
    questionContent.appendChild(answerCells);
    
    questionItem.appendChild(questionNumber);
    questionItem.appendChild(questionContent);
    questions.appendChild(questionItem);
  });

  const ladder = $('#ladder'); 
  ladder.innerHTML = '';
  
  for(let i=0;i<DATA.rows.length;i++){
    const step = document.createElement('button'); 
    step.className='btn-secondary'; 
    step.dataset.open=i; 
    step.textContent = `C√ÇU ${i+1}`; 
    ladder.appendChild(step);
  }

  const msg = $('#finalMsg');
  if (DATA.rows.length !== L){
    msg.textContent = `L∆∞u √Ω: C√≥ ${DATA.rows.length} c√¢u h·ªèi nh∆∞ng t·ª´ kh√≥a d√†i ${L} k√Ω t·ª±.`;
  }
  
  $('#answersPanel').classList.remove('active');
}

function scrollToKeyword(){
  const el = $('#keyword');
  if(!el) return;
  el.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function openQA(idx){
  currentRow = idx; 
  $('#qa').classList.add('active'); 
  $('#qtext').textContent = DATA.rows[idx].q; 
  $('#answer').value=''; 
  $('#feedback').textContent=''; 
  $('#answer').focus();
  
  $('#qa').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function checkAnswer(){
  if(currentRow===null) return;
  const row = DATA.rows[currentRow];
  const user = stripSpaces(normalizeVN($('#answer').value)); 
  if(!user){ 
    $('#feedback').textContent='Vui l√≤ng nh·∫≠p ƒë√°p √°n!'; 
    return; 
  }
  const ok = user === stripSpaces(normalizeVN(row.a));
  if(ok){ 
    revealRow(currentRow); 
    $('#feedback').textContent='Ch√≠nh x√°c! ƒê√°p √°n ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã.'; 
    setTimeout(() => {
      $('#qa').classList.remove('active');
      currentRow = null;
    }, 1200);
    setTimeout(scrollToKeyword, 1300);
  }
  else { 
    $('#feedback').textContent='Ch∆∞a ch√≠nh x√°c. H√£y th·ª≠ l·∫°i!'; 
    $('#answer').classList.add('shake'); 
    setTimeout(()=>$('#answer').classList.remove('shake'),400); 
  }
}

function revealRow(idx){
  const questionItem = $(`.question-item[data-idx="${idx}"]`); 
  if(!questionItem) return;
  
  const row = DATA.rows[idx];
  const cells = questionItem.querySelectorAll('.answer-cell');
  const disp = stripSpaces(toUpperKeepVN(row.a));
  
  cells.forEach((c,i)=>{ 
    c.textContent = disp[i]; 
    c.classList.add('revealed'); 
  });
  
  questionItem.classList.add('solved'); 
  solved.add(idx);

  const slots = $$('#keyword .keyword-cell');
  const col = row.crossAt;
  if (col < slots.length){
    const pivotChar = disp[row.pick] || '?';
    acroLetters[col] = pivotChar;
    const slot = slots[col]; 
    slot.textContent = pivotChar; 
    slot.classList.add('ready');
  }
}

function restart(){ 
  currentRow=null; 
  solved=new Set(); 
  keywordSolved = false;
  build(); 
  $('#qa').classList.remove('active'); 
  $('#finalGuess').value=''; 
  $('#finalMsg').textContent='Tr·∫£ l·ªùi ƒë√∫ng m·ªói c√¢u h·ªèi s·∫Ω h√© l·ªô m·ªôt ch·ªØ c√°i trong t·ª´ kh√≥a';
}

function guessFinal(){
  const guess = stripSpaces(normalizeVN($('#finalGuess').value));
  if(!guess){
    $('#finalMsg').textContent='Nh·∫≠p t·ª´ kh√≥a c·∫ßn ƒëo√°n nh√©!';
    return;
  }

  const target = keyNormalized();
  if(guess === target){
    // 1Ô∏è‚É£ ƒêi·ªÅn keyword d·ªçc
    fillKeyword(stripSpaces(toUpperKeepVN(DATA.keyword)));

    // 2Ô∏è‚É£ M·ªü to√†n b·ªô h√†ng (k·ªÉ c·∫£ ch∆∞a tr·∫£ l·ªùi)
    DATA.rows.forEach((_, i)=>{
      if(!solved.has(i)) revealRow(i);
    });

    // 3Ô∏è‚É£ Hi·ªán to√†n b·ªô c√¢u h·ªèi trong class question-item
    document.querySelectorAll('.question-item').forEach(q=>{
      q.style.display = 'block';
      q.classList.add('revealed');
    });

    // 4Ô∏è‚É£ Th√¥ng b√°o chi·∫øn th·∫Øng
    $('#finalMsg').textContent = 'Tuy·ªát v·ªùi! B·∫°n ƒë√£ ƒëo√°n ƒë√∫ng t·ª´ kh√≥a: ' + DATA.keyword;
    celebrate();
  } else {
    $('#finalMsg').textContent = 'Ch∆∞a ƒë√∫ng. Th·ª≠ l·∫°i nh√©!';
  }
}

function fillKeyword(target){ 
  const slots=$$('#keyword .keyword-cell'); 
  const L=Math.min(target.length,slots.length); 
  for(let i=0;i<L;i++){ 
    slots[i].textContent=target[i]; 
    slots[i].classList.add('ready'); 
    acroLetters[i]=target[i]; 
  } 
}

function showAllAnswers() {
  const answersList = $('#answersList');
  answersList.innerHTML = '';
  
  DATA.rows.forEach((item, idx) => {
    const answerItem = document.createElement('div');
    answerItem.className = 'answer-item';
    answerItem.innerHTML = `
      <div class="answer-question">C√¢u ${idx+1}: ${item.q}</div>
      <div class="answer-text">${item.a}</div>
    `;
    answersList.appendChild(answerItem);
  });
  
  $('#answersPanel').classList.add('active');
}

function celebrate(){ 
  const confetti=document.createElement('div'); 
  confetti.className = 'confetti';
  confetti.innerHTML = `
    <svg width="100%" height="100%" preserveAspectRatio="none">
      ${[...Array(100)].map(()=>{ 
        const x=Math.random()*100,d=6+Math.random()*10,dur=2+Math.random()*1.8; 
        return `<rect x="${x}%" y="-10" width="${d}" height="${d}" rx="2" ry="2" fill="url(#g)" style="animation:f ${dur}s linear forwards; opacity:.9"/>`; 
      }).join('')}
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#22d3ee"/>
          <stop offset="50%" stop-color="#a78bfa"/>
          <stop offset="100%" stop-color="#4a7c1f"/>
        </linearGradient>
      </defs>
      <style>
        @keyframes f {
          to {
            transform: translateY(110vh) rotate(360deg);
          }
        }
      
.home-btn {
  position: fixed;
  top: 12px;
  right: 12px;
  background: #007bff;
  color: #fff;
  font-weight: bold;
  padding: 10px 16px;
  border-radius: 8px;
  text-decoration: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  font-size: 15px;
  z-index: 1000;
  transition: background 0.3s;
}
.home-btn:hover {
  background: #0056b3;
}

</style>
    </svg>
  `; 
  document.body.appendChild(confetti); 
  setTimeout(()=>confetti.remove(),3500); 
}

$('#questions').addEventListener('click', e=>{ 
  const btn=e.target.closest('.question-item'); 
  if(btn){ 
    openQA(+btn.dataset.idx); 
  } 
});

$('#btnCheck').addEventListener('click', checkAnswer);
$('#answer').addEventListener('keydown', e=>{ 
  if(e.key==='Enter') checkAnswer(); 
});
$('#btnClose').addEventListener('click', ()=>{ 
  $('#qa').classList.remove('active'); 
  currentRow=null; 
  scrollToKeyword();
});
$('#btnRestart').addEventListener('click', restart);
$('#btnFinal').addEventListener('click', guessFinal);
$('#ladder').addEventListener('click', e=>{ 
  const step=e.target.closest('button[data-open]'); 
  if(step){ 
    openQA(+step.dataset.open); 
  }
});

build();
</script>

<script>
  const homeBtn = document.getElementById('homeBtn');
  homeBtn.addEventListener('click', function(e) {
    if (this.getAttribute('href') === 'https://thanhhungk57.github.io/baotuong/') {
      e.preventDefault();
      alert('üí° H√£y g·∫Øn ƒë∆∞·ªùng link trang ch·ªß c·ªßa b·∫°n v√†o thu·ªôc t√≠nh href trong n√∫t n√†y!');
    }
  });
</script>

</body>
</html>
